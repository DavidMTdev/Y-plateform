{% extends 'base.html.twig' %}

{% block title %}Dashboard Member Jeux {% endblock %}

{% block content %}
<button class="modify-game-js">modifier</button>
<a href="{{ path('GameDelete', {'id': game.id}) }}">supprimer</a>
<h1>Dashboard {{game.name}}</h1>

<h1>Nombre telechargement : {{game.nbDownload}}</h1>
<h1>Commentaire : {{game.comments | length}}</h1>
<h1>note : {{note[0].note}}</h1>


<h1>Infos du jeux</h1>
<img height="50px" src="{{ asset('/gameImg/')}}{{game.img }}" alt="">
<p>{{game.descriptionG}}</p>

<h1>Commentaires</h1>
{% for comment in comments %}
<p>desc : {{comment.descriptionC}}</p>
<p>pseudo : {{comment.user.pseudo}}</p>
<p>date : {{comment.dateC.date|date("F jS \\a\\t g:ia") }}</p>
{% endfor %}

<h1>Categorie</h1>
{% for value in category %}
<p>{{value.title}}</p>
{% endfor %}
<button class="modify-category-js">+</button>


<div class="popup game">
    <div class="popup-content">
        <h1>Modification</h1>
        <img class="close-js" src="{{ asset('/img/close.png')}}" alt="">

        {{form_start(formModifyGame)}}
        {{form_widget(formModifyGame)}}
        <button type="submit"> Modifier </button> {{form_end(formModifyGame)}}

    </div>
</div>

<div class="popup category">
    <div class="popup-content">
        <h1>Modification categorie</h1>
        <img class="close-category-js" src="{{ asset('/img/close.png')}}" alt="">
        <form action="" method="post">
            <input class="search-js" type="text">
            <div class="result-search-js"></div>

            {% for value in category %}
                <a href="{{ path('CategoryDelete', {'idGame': id, 'id': value.id}) }}">{{value.title}} -</a>
            {% endfor %}

            <button type="submit"> Modifier </button>
        </form>
    </div>
</div>

<input class="hidden-js" type="hidden" value="{{pop}}">
<style>
    .popup {
        background: rgba(0, 0, 0, 0.6);
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0%;
        display: none;
        justify-content: center;
        align-items: center;
    }

    .popup-content {
        height: 350px;
        width: 600px;
        background: white;
        padding: 20px;
        border-radius: 2px;
        position: relative;
        box-shadow: 6px 6px 29px -4px rgba(0, 0, 0, 0.75);
    }

    .close-js,
    .close-category-js {
        position: absolute;
        top: 5px;
        right: 5px;
        cursor: pointer;
    }
</style>
{% endblock %}

{% block js %}
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>

<script>

    var inputHidden = document.querySelector('.hidden-js')
    if(inputHidden != null){
        if(inputHidden.value == 1){
            document.querySelector('.category').style.display = 'flex'
            document.querySelector('body').style.overflow = 'hidden'
        }else{
            document.querySelector('.category').style.display = 'none'
            document.querySelector('body').style.overflow = 'visible'
        }
        document.querySelector('.close-category-js').addEventListener('click', function () {
            inputHidden.value = 0
        })
    }
    

    modifyGame = document.querySelector('.modify-game-js')
    modifyGame.addEventListener('click', function () {
        document.querySelector('.game').style.display = 'flex'
        document.querySelector('body').style.overflow = 'hidden'
    })

    document.querySelector('.close-js').addEventListener('click', function () {
        document.querySelector('.game').style.display = 'none'
        document.querySelector('body').style.overflow = 'visible'
    })

    modifyCategory = document.querySelector('.modify-category-js')
    modifyCategory.addEventListener('click', function () {
        document.querySelector('.category').style.display = 'flex'
        document.querySelector('body').style.overflow = 'hidden'
    })

    document.querySelector('.close-category-js').addEventListener('click', function () {
        document.querySelector('.category').style.display = 'none'
        document.querySelector('body').style.overflow = 'visible'
    })

    $(document).ready(function(){
        $('.search-js').keyup(function(){
            $('.result-search-js').html('');
            var category = $(this).val();
            if (category != ''){
                $.ajax({
                    type: 'GET',
                    url: "{{ path('searchCategory', {'game': id}) }}",
                    data: 'category=' + encodeURIComponent(category),
                    success: function(data){
                        if(data != ""){
                            $('.result-search-js').append(data);
                        }else{
                            $('.result-search-js').textContent = "aucune categorie";
                        }
                    }
                })
                
            }
            
        })
    });
</script>
{% endblock %}